<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ELECTROTEC</title>
  <link rel="icon" href="inicio/media/iconoElectro.png">
  <link
    href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
  <link rel="stylesheet" href="registro/registro.css">
</head>

<body>
  <header>
    <div class="container">
      <nav>
        <div class="container">
          <a href="index.html" class="active">INICIO</a>
          <hr>
          <a href="tienda.html">TIENDA</a>
          <hr>
          <a href="nosotros.html">NOSOTROS</a>
          <hr>
          <a href="contactanos.html">CONTÁCTANOS</a>
          <a href="search" class="search"><i class="uil uil-search"></i></a>
        </div>
      </nav>
      <div class="encabezado">
        <a href="registro.html"><i class="uil uil-user-circle"></i>Mi cuenta</a>
      </div>
    </div>
  </header>



  <section id="slides-mi-cuenta">
    <div class="container">
      <ul class="slides">
        <li id="cambio-contraseña">
          <div id="mi-cuenta">
            <div class="box">
              <div class="square" style="--i:0;"></div>
              <div class="square" style="--i:1;"></div>
              <div class="square" style="--i:2;"></div>
              <div class="square" style="--i:3;"></div>
              <div class="square" style="--i:4;"></div>
              <div class="container-cuenta">
                <img src="inicio/media/iconoElectro.png" alt="">
                <div class="form">
                  <h2>¿Olvidaste tu contraseña?</h2>
                  <form>
                    <div class="inputBox">
                      <input type="email" placeholder="Correo electrónico">
                    </div>
                    <p>Ingresa tu correo electrónico para poder ayudarte a restablecer tu contraseña</p>
                    <div class="inputBox">
                      <input type="submit" value="Enviar">
                    </div>
                    <p>Puedes iniciar sesión con:</p>
                    <div class="redes">
                      <a href="https://mail.google.com/" target="_blank"><i class="uil uil-google"></i></a>
                      <a href="https://www.facebook.com" target="_blank"><i class="uil uil-facebook-f"></i></a>
                    </div>
                    <div class="links">
                      <a href="#iniciar-sesion" class="inicia-sesion">Inicia sesión</a>
                      <a href="#registrarse" class="new">Crear cuenta nueva</a>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </li>
        <li id="registrarse">
          <div id="mi-cuenta">
            <div class="box">
              <div class="square" style="--i:0;"></div>
              <div class="square" style="--i:1;"></div>
              <div class="square" style="--i:2;"></div>
              <div class="square" style="--i:3;"></div>
              <div class="square" style="--i:4;"></div>
              <div class="container-cuenta">
                <div class="form">
                  <h2>Registrarse</h2>
                  <form id="registroForm">
                    <div class="inputBox">
                      <input type="text" name="nombre" placeholder="Nombre de usuario" required>
                    </div>
                    <div class="inputBox">
                      <input type="email" name="email" placeholder="Correo electrónico" required>
                    </div>
                    <div class="inputBox">
                      <input type="password" name="password" placeholder="Contraseña" required>
                    </div>
                    <div class="inputBox">
                      <input type="number" placeholder="Teléfono">
                    </div>
                    <div class="inputBox">
                      <select name="identidad">
                        <option value="_none">Seleccione un valor</option>
                        <option value="dni">DNI</option>
                        <option value="carnet">Carnet de extranjería</option>
                      </select>
                    </div>
                    <div class="inputBox">
                      <input type="number" placeholder="Documento">
                    </div>
                    <div class="inputBox">
                      <input type="submit" value="Crear cuenta">
                    </div>
                    <p id="registroMensaje" style="text-align: center; margin-bottom: 15px;"></p>
                    <p>También puedes registrarte con:</p>
                    <div class="redes">
                      <a href="https://mail.google.com/" target="_blank"><i class="uil uil-google"></i></a>
                      <a href="https://www.facebook.com" target="_blank"><i class="uil uil-facebook-f"></i></a>
                    </div>
                    <div class="links">
                      <p>¿Ya tienes cuenta?</p>
                      <a href="#iniciar-sesion" class="inicia-sesion">Inicia sesión</a>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </li>
        <li id="iniciar-sesion">
          <div id="mi-cuenta">
            <div class="box">
              <div class="square" style="--i:0;"></div>
              <div class="square" style="--i:1;"></div>
              <div class="square" style="--i:2;"></div>
              <div class="square" style="--i:3;"></div>
              <div class="square" style="--i:4;"></div>
              <div class="container-cuenta">
                <img src="inicio/media/iconoElectro.png" alt="">
                <div class="form">
                  <h2>Inicia sesión</h2>
                  <form id="loginForm">
                    <div class="inputBox">
                      <input type="email" name="email" placeholder="Correo electrónico" required>
                    </div>
                    <div class="inputBox">
                      <input type="password" name="password" placeholder="Contraseña" required>
                    </div>
                    <div class="inputBox">
                      <input type="submit" value="Iniciar sesión">
                    </div>
                    <p id="loginMensaje" style="text-align: center; margin-bottom: 15px;"></p>
                    <p>También puedes iniciar sesión con:</p>
                    <div class="redes">
                      <a href="https://mail.google.com/" target="_blank"><i class="uil uil-google"></i></a>
                      <a href="https://www.facebook.com" target="_blank"><i class="uil uil-facebook-f"></i></a>
                    </div>
                    <div class="links">
                      <a href="#cambio-contraseña" class="forget">¿Olvidaste tu contraseña?</a>
                      <a href="#registrarse" class="new">Crear cuenta nueva</a>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </section>
  <footer>
    <div id="final">
      <div class="container">
        <div class="logo"><img src="inicio/media/Electrotec2.png" alt="electrotec" width="350px" height="120px">
        </div>
        <article class="lista-final">
          <ul>
            <li class="lista">Link de interés</li>
            <li><a href="">Tienda</a></li>
            <li><a href="">Contacto</a></li>
          </ul>
          <ul>
            <li class="lista">Mi cuenta</li>
            <li><a href="">Registrarse</a></li>
            <li><a href="">Ajuste de Cuenta</a></li>
          </ul>
          <ul>
            <li class="lista">Soporte</li>
            <li><a href="">Términos y condiciones</a></li>
            <li><a href="">Política de privacidad</a></li>
          </ul>
          <ul>
            <li class="lista">Contáctanos</li>
            <li><a href="">Telf: (01) 2412121</a></li>
            <li><a href="">electrotec@cib.pe</a></li>
          </ul>
        </article>
      </div>
    </div>

    <div id="redes">
      <a href="https://www.instagram.com" target="_blank"><i class="uil uil-instagram"></i></a>
      <a href="https://twitter.com" target="_blank"><i class="uil uil-twitter-alt"></i></a>
      <a href="https://www.facebook.com" target="_blank"><i class="uil uil-facebook-f"></i></a>
    </div>

    <div id="link-wsp">
      <div class="container">
        <div class="button-footer">
          <button class="button-wsp">
            <a href="https://api.whatsapp.com/" target="_blank"><i class="uil uil-whatsapp"></i>Hola, ¿en qué puedo
              ayudarte?</a>
          </button>
        </div>
        <div class="derechos">
          <h5>&copy; Electrotec, todos los derechos reservados.</h5>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // --- Lógica para el formulario de REGISTRO ---
    document.getElementById('registroForm').addEventListener('submit', async (event) => {
      event.preventDefault(); // Evita que el formulario se envíe de la forma tradicional

      const form = event.target;
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      const mensajeEl = document.getElementById('registroMensaje');

      try {
        const response = await fetch('http://localhost:3000/api/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (response.ok) {
          mensajeEl.style.color = 'lightgreen';
          mensajeEl.textContent = result.message + ' Redirigiendo a inicio de sesión...';
          form.reset();
          // Espera 2 segundos y cambia al slide de iniciar sesión
          setTimeout(() => {
            window.location.hash = 'iniciar-sesion';
            mensajeEl.textContent = '';
          }, 2000);
        } else {
          mensajeEl.style.color = 'orangered';
          mensajeEl.textContent = 'Error: ' + result.message;
        }
      } catch (error) {
        console.error('Error de conexión:', error);
        mensajeEl.style.color = 'orangered';
        mensajeEl.textContent = 'No se pudo conectar con el servidor.';
      }
    });

    // --- Lógica para el formulario de LOGIN ---
    document.getElementById('loginForm').addEventListener('submit', async (event) => {
      event.preventDefault();

      const form = event.target;
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      const mensajeEl = document.getElementById('loginMensaje');

      try {
        const response = await fetch('http://localhost:3000/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (response.ok) {
          mensajeEl.style.color = 'lightgreen';
          mensajeEl.textContent = result.message + ' Redirigiendo...';

          // 1. Guardar la información del usuario en el almacenamiento local del navegador
          localStorage.setItem('usuario', JSON.stringify({ nombreUsuario: result.nombreUsuario }));

          // 2. Redirigir a la página principal después de 1.5 segundos
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1500);
        } else {
          mensajeEl.style.color = 'orangered';
          mensajeEl.textContent = 'Error: ' + result.message;
        }
      } catch (error) {
        console.error('Error de conexión:', error);
        mensajeEl.style.color = 'orangered';
        mensajeEl.textContent = 'No se pudo conectar con el servidor.';
      }
    });
  </script>
</body>

</html>